[SERVICE]
    Daemon              off
    Flush               1
    Log_Level           info
    Parsers_File        parsers.conf
    HTTP_Server         On
    HTTP_Listen         0.0.0.0
    HTTP_Port           2020
    Health_Check        On

# Docker 로그 수집 (Forward 입력)
[INPUT]
    Name                forward
    Listen              0.0.0.0
    Port                24224
    Buffer_Chunk_Size   1M
    Buffer_Max_Size     6M

# JSON 파싱
[FILTER]
    Name                parser
    Match               *
    Key_Name            log
    Parser              docker
    Reserve_Data        On
    Preserve_Key        On

# 필수 필드 추가 및 정제
[FILTER]
    Name                modify
    Match               *
    Add                 type log
    Add                 environment dev
    Rename              log message

# trace_id, span_id가 있으면 유지 (NestJS에서 추가했다면)
# 없으면 null로 설정하지 않음 (producer에서 처리)

# 외부 Producer 서버로 전송 (HTTP)
# 환경변수: PRODUCER_HOST, PRODUCER_PORT
[OUTPUT]
    Name                http
    Match               *
    Host                ${PRODUCER_HOST}
    Port                ${PRODUCER_PORT}
    URI                 /ingest/logs
    Format              json
    Json_date_key       timestamp
    Json_date_format    iso8601
    Retry_Limit         3
    tls                 Off

# 디버깅용 stdout
[OUTPUT]
    Name                stdout
    Match               *
    Format              json_lines
