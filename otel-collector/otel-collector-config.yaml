receivers:
  # OTLP gRPC receiver
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  # 배치 처리로 성능 향상
  batch:
    timeout: 5s
    send_batch_size: 1024

  # 리소스 속성 추가
  resource:
    attributes:
      - key: environment
        value: dev
        action: insert

  # 메모리 제한
  memory_limiter:
    check_interval: 1s
    limit_mib: 512

exporters:
  # 외부 Producer 서버로 HTTP 전송
  # 환경변수: PRODUCER_OTLP_ENDPOINT (기본값: http://localhost:4319)
  otlphttp:
    endpoint: ${PRODUCER_OTLP_ENDPOINT}
    compression: gzip
    tls:
      insecure: true

  # 디버깅용 로깅
  logging:
    verbosity: detailed
    sampling_initial: 5
    sampling_thereafter: 200

  # Prometheus metrics (옵션)
  prometheus:
    endpoint: 0.0.0.0:8889

extensions:
  health_check:
    endpoint: 0.0.0.0:13133

  pprof:
    endpoint: 0.0.0.0:1777

service:
  extensions: [health_check, pprof]

  pipelines:
    # Traces 파이프라인
    traces:
      receivers: [otlp]
      processors: [memory_limiter, resource, batch]
      exporters: [otlphttp, logging]

    # Metrics 파이프라인 (옵션)
    metrics:
      receivers: [otlp]
      processors: [memory_limiter, resource, batch]
      exporters: [prometheus, logging]
